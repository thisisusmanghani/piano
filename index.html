<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StringMaster | Learn Guitar Online</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="templatemo-606-string-master.css">
  <!--

TemplateMo 606 String Master

https://templatemo.com/tm-606-string-master

-->
</head>

<body>

  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="#" class="logo">
        <div class="logo-icon">â™ª</div>
        StringMaster
      </a>
      <ul class="nav-links">
        <li><a href="#features">Features</a></li>
        <li><a href="#pricing">Pricing</a></li>
        <li><a href="#instructors">Instructors</a></li>
        <li><a href="#testimonials">Reviews</a></li>
      </ul>
      <a href="#pricing" class="nav-cta"><span>Start Dummy Trial</span></a>
    </div>
  </nav>

  <!-- Hero Section -->
  <!-- TIP: To enable full-screen hero, uncomment "min-height: 100vh" in the .hero CSS -->
  <section class="hero">
    <div class="hero-container">
      <div class="hero-content">
        <div class="hero-badge">
          <span></span> Cloud Studio V2
        </div>
        <h1>Your <span class="highlight">Digital Studio</span>.<br>Anywhere, Anytime.</h1>
        <p class="hero-description">
          The ultimate browser-based production suite for artists.
          Sketch ideas, record demos, and master your sound using our suite of professional instruments.
        </p>
        <div class="hero-buttons">
          <a href="#digital-studio" class="btn-primary">
            Open Studio â†’
          </a>
          <a href="#tools" class="btn-secondary">
            Explore Tools
          </a>
        </div>
        <div class="hero-stats">
          <div class="stat">
            <div class="stat-value">5k+</div>
            <div class="stat-label">Users/Artists</div>
          </div>
          <div class="stat">
            <div class="stat-value">12+</div>
            <div class="stat-label">Instruments</div>
          </div>
          <div class="stat">
            <div class="stat-value">Studio</div>
            <div class="stat-label">Grade Audio</div>
          </div>
        </div>
      </div>

      <!-- Interactive Guitar -->
      <div class="guitar-wrapper">
        <div class="guitar-card">
          <div class="guitar-header">
            <span class="guitar-title">Try it â€” Click a chord</span>
            <div class="guitar-controls">
              <button class="chord-btn" data-chord="C">C</button>
              <button class="chord-btn" data-chord="G">G</button>
              <button class="chord-btn" data-chord="Am">Am</button>
              <button class="chord-btn" data-chord="F">F</button>
              <button class="chord-btn" data-chord="D">D</button>
              <button class="chord-btn" data-chord="Em">Em</button>
            </div>
          </div>
          <div class="guitar-neck">
            <div class="fretboard">
              <div class="nut"></div>
              <div class="fretboard-grid" id="fretboard">
                <div class="string-labels">
                  <div class="string-label">E</div>
                  <div class="string-label">B</div>
                  <div class="string-label">G</div>
                  <div class="string-label">D</div>
                  <div class="string-label">A</div>
                  <div class="string-label">E</div>
                </div>
                <!-- Frets generated by JS -->
              </div>
            </div>
          </div>
          <div class="guitar-footer">
            <div class="guitar-footer-row">
              <span class="guitar-hint">Click frets to play notes</span>
              <div class="footer-controls">
                <button class="clear-btn" id="clearBtn">Clear</button>
                <div class="sound-toggle">
                  <span>Sound</span>
                  <div class="toggle-switch active" id="soundToggle"></div>
                </div>
              </div>
            </div>
            <div class="song-player">
              <button class="play-btn" id="playBtn">â–¶</button>
              <div class="song-info">
                <div class="song-title" id="songTitle">Greensleeves</div>
                <div class="song-progress">
                  <div class="song-progress-bar" id="progressBar"></div>
                </div>
              </div>
              <select class="song-select" id="songSelect">
                <option value="greensleeves">Greensleeves</option>
                <option value="houseoftherisingsun">House of the Rising Sun</option>
                <option value="amazinggrace">Amazing Grace</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  </section>



  <!-- DIGITAL STUDIO WRAPPER -->
  <section id="digital-studio" style="background: #09090b; border-bottom: 1px solid #27272a; padding-bottom: 4rem;">
    <div class="section-container" style="padding: 4rem 1rem 0;">
      <div class="studio-header" style="text-align: center; margin-bottom: 4rem;">
        <span class="section-label"
          style="color: #10b981; letter-spacing: 0.1em; font-weight: 600; font-size: 0.8rem; text-transform: uppercase;">Interactive
          Studio</span>
        <h2 class="section-title"
          style="font-size: 2.5rem; margin: 0.5rem 0; background: linear-gradient(to right, #fff, #a1a1aa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
          Digital Jam Session</h2>
        <p class="section-description" style="max-width: 600px; margin: 0 auto 2rem; color: #a1a1aa;">
          Experience the power of our audio engine. Start a session to hear them play together.
        </p>
        <button onclick="startJamSession()"
          style="padding: 1rem 2.5rem; background: #10b981; color: #000; border: none; border-radius: 99px; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 0 30px rgba(16, 185, 129, 0.25); transition: transform 0.2s; display: inline-flex; align-items: center; gap: 0.5rem;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z" />
          </svg>
          Start Jam Session
        </button>
      </div>
    </div>

    <!-- Visualizer Section -->
    <section id="visualizer-tool"
      style="background: transparent; padding: 0 0 2rem 0; border: none; position: relative; overflow: hidden; display: block;">
      <div class="section-container" style="position: relative; z-index: 2;">
        <div class="section-header">
          <div class="section-label">Visual Engine</div>
          <h2 class="section-title">Audio Spectrum</h2>
          <p class="section-description">Real-time frequency analysis of your performance.</p>
          <button id="testAudioBtn"
            style="margin-top: 1rem; padding: 0.5rem 1rem; background: #27272a; border: 1px solid #3f3f46; color: #fff; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
            â–¶ Test Audio
          </button>
        </div>
        <canvas id="audioVisualizer" width="1000" height="200"
          style="width: 100%; height: 200px; background: #18181b; border-radius: 12px; border: 1px solid #27272a; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);"></canvas>
      </div>
    </section>

    <!-- MASTER MIXER -->
    <div class="mixer-panel"
      style="max-width: 1000px; margin: 2rem auto; background: #18181b; border: 1px solid #27272a; border-radius: 12px; padding: 1.5rem; display: flex; flex-wrap: wrap; gap: 2rem; justify-content: space-around; align-items: center;">
      <div class="fader-group">
        <input type="range" id="drumVol" min="0" max="1" step="0.01" value="1.0">
        <label>Drums</label>
      </div>
      <div class="fader-group">
        <input type="range" id="pianoVol" min="0" max="1" step="0.01" value="0.5">
        <label>Piano</label>
      </div>
      <div class="fader-group">
        <input type="range" id="bassVol" min="0" max="1" step="0.01" value="0.4">
        <label>Bass</label>
      </div>
      <div class="fader-group">
        <input type="range" id="leadVol" min="0" max="1" step="0.01" value="0.3">
        <label>Lead</label>
      </div>
      <div class="fader-group">
        <input type="range" id="atmVol" min="0" max="1" step="0.01" value="0.05">
        <label>Atmosphere</label>
      </div>
    </div>

    <!-- Drum Machine Section (Step 1) -->
    <section class="tool-section" id="drum-tool" style="border-bottom: 1px solid #27272a; padding: 3rem 0;">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label" style="color: #10b981;">Step 1: Rhythm Engine</div>
          <h2 class="section-title">Lay down the beat</h2>
          <p class="section-description">
            Click the grid to build a loop or load a preset.
            <span class="instruction-badge"
              style="display: inline-block; background: #27272a; border: 1px solid #3f3f46; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-left: 10px; color: #fff;">ðŸ‘‡
              Click Grid</span>
          </p>
        </div>

        <div class="drum-wrapper">
          <div class="drum-header">
            <div class="lcd-display">
              <span class="label">BPM</span>
              <span class="value" id="bpmValue">120</span>
            </div>

            <div class="preset-controls" style="display: flex; gap: 0.5rem; margin: 0 1rem;">
              <button class="btn-preset" onclick="loadDrumPreset('clear')"
                style="font-size: 0.8rem; padding: 0.2rem 0.5rem; background: #27272a; border: 1px solid #3f3f46; color: #a1a1aa; border-radius: 4px; cursor: pointer;">Clear</button>
              <button class="btn-preset" onclick="loadDrumPreset('rock')"
                style="font-size: 0.8rem; padding: 0.2rem 0.5rem; background: #27272a; border: 1px solid #3f3f46; color: #fff; border-radius: 4px; cursor: pointer;">Rock</button>
              <button class="btn-preset" onclick="loadDrumPreset('techno')"
                style="font-size: 0.8rem; padding: 0.2rem 0.5rem; background: #27272a; border: 1px solid #3f3f46; color: #fff; border-radius: 4px; cursor: pointer;">Techno</button>
            </div>

            <div class="transport-controls">
              <button class="transport-btn play" id="drumPlay">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z" />
                </svg>
              </button>
              <button class="transport-btn stop" id="drumStop">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M6 6h12v12H6z" />
                </svg>
              </button>
            </div>
          </div>

          <div class="sequencer-grid">
            <!-- Kick Row -->
            <div class="track-row">
              <div class="track-label">KICK</div>
              <div class="steps" data-track="kick">
                <div class="step" data-step="0"></div>
                <div class="step" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
                <div class="step" data-step="5"></div>
                <div class="step" data-step="6"></div>
                <div class="step" data-step="7"></div>
                <div class="step" data-step="8"></div>
                <div class="step" data-step="9"></div>
                <div class="step" data-step="10"></div>
                <div class="step" data-step="11"></div>
                <div class="step" data-step="12"></div>
                <div class="step" data-step="13"></div>
                <div class="step" data-step="14"></div>
                <div class="step" data-step="15"></div>
              </div>
            </div>
            <!-- Snare Row -->
            <div class="track-row">
              <div class="track-label">SNARE</div>
              <div class="steps" data-track="snare">
                <div class="step" data-step="0"></div>
                <div class="step" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
                <div class="step" data-step="5"></div>
                <div class="step" data-step="6"></div>
                <div class="step" data-step="7"></div>
                <div class="step" data-step="8"></div>
                <div class="step" data-step="9"></div>
                <div class="step" data-step="10"></div>
                <div class="step" data-step="11"></div>
                <div class="step" data-step="12"></div>
                <div class="step" data-step="13"></div>
                <div class="step" data-step="14"></div>
                <div class="step" data-step="15"></div>
              </div>
            </div>
            <!-- HiHat Row -->
            <div class="track-row">
              <div class="track-label">HI-HAT</div>
              <div class="steps" data-track="hihat">
                <div class="step" data-step="0"></div>
                <div class="step" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
                <div class="step" data-step="5"></div>
                <div class="step" data-step="6"></div>
                <div class="step" data-step="7"></div>
                <div class="step" data-step="8"></div>
                <div class="step" data-step="9"></div>
                <div class="step" data-step="10"></div>
                <div class="step" data-step="11"></div>
                <div class="step" data-step="12"></div>
                <div class="step" data-step="13"></div>
                <div class="step" data-step="14"></div>
                <div class="step" data-step="15"></div>
              </div>
            </div>
            <!-- Clap Row -->
            <div class="track-row">
              <div class="track-label">CLAP</div>
              <div class="steps" data-track="clap">
                <div class="step" data-step="0"></div>
                <div class="step" data-step="1"></div>
                <div class="step" data-step="2"></div>
                <div class="step" data-step="3"></div>
                <div class="step" data-step="4"></div>
                <div class="step" data-step="5"></div>
                <div class="step" data-step="6"></div>
                <div class="step" data-step="7"></div>
                <div class="step" data-step="8"></div>
                <div class="step" data-step="9"></div>
                <div class="step" data-step="10"></div>
                <div class="step" data-step="11"></div>
                <div class="step" data-step="12"></div>
                <div class="step" data-step="13"></div>
                <div class="step" data-step="14"></div>
                <div class="step" data-step="15"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Virtual Piano Section -->
    <section class="tool-section" id="piano-tool">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label">Virtual Instrument</div>
          <h2 class="section-title">Grand Piano Engine</h2>
          <p class="section-description">
            Low-latency synthesis with touch response and MIDI support. Use your keyboard to play.
          </p>
        </div>

        <div class="piano-wrapper" style="max-width: 1000px; margin: 0 auto;">
          <div class="piano-controls">
            <div class="control-group">
              <!-- Enhanced Volume Slider for Visibility -->
              <label>Master Vol</label>
              <input type="range" min="0" max="1" step="0.01" value="0.5" id="pianoVolume"
                style="accent-color: var(--primary);">
            </div>
            <div class="control-group">
              <div class="toggle-switch" id="sustainToggle"></div>
              <label>Sustain</label>
            </div>

            <!-- New Piano Song Player -->
            <div class="song-player separator-left"
              style="margin-left: auto; border: none; background: transparent; padding: 0;">
              <button class="play-btn" id="pianoPlayBtn">â–¶</button>
              <div class="song-info" style="min-width: 150px;">
                <div class="song-title" id="pianoSongTitle" style="color:white; opacity:0.8;">Select Song</div>
                <!-- Simple visualizer/progress -->
                <div class="song-progress" style="background: rgba(255,255,255,0.1);">
                  <div class="song-progress-bar" id="pianoProgressBar" style="width: 0%;"></div>
                </div>
              </div>
              <select class="song-select" id="pianoSongSelect" style="min-width: 180px;">
                <option value="" disabled selected>Load Preset...</option>
                <option value="moonlight">Moonlight Sonata</option>
                <option value="fur_elise">Fur Elise</option>
                <option value="twinkle">Twinkle Twinkle</option>
                <option value="scale_c">C Major Scale</option>
              </select>
            </div>
          </div>

          <div class="piano-keys" id="pianoKeys">
            <!-- Keys generated via JS or hardcoded? Hardcoding for control/debugging -->
            <!-- Octave 3 -->
            <div class="key white" data-note="C3" data-key="a"><span>A</span></div>
            <div class="key black" data-note="C#3" data-key="w"><span>W</span></div>
            <div class="key white" data-note="D3" data-key="s"><span>S</span></div>
            <div class="key black" data-note="D#3" data-key="e"><span>E</span></div>
            <div class="key white" data-note="E3" data-key="d"><span>D</span></div>
            <div class="key white" data-note="F3" data-key="f"><span>F</span></div>
            <div class="key black" data-note="F#3" data-key="t"><span>T</span></div>
            <div class="key white" data-note="G3" data-key="g"><span>G</span></div>
            <div class="key black" data-note="G#3" data-key="y"><span>Y</span></div>
            <div class="key white" data-note="A3" data-key="h"><span>H</span></div>
            <div class="key black" data-note="A#3" data-key="u"><span>U</span></div>
            <div class="key white" data-note="B3" data-key="j"><span>J</span></div>

            <!-- Octave 4 -->
            <div class="key white" data-note="C4" data-key="k"><span>K</span></div>
            <div class="key black" data-note="C#4" data-key="o"><span>O</span></div>
            <div class="key white" data-note="D4" data-key="l"><span>L</span></div>
            <div class="key black" data-note="D#4" data-key="p"><span>P</span></div>
            <div class="key white" data-note="E4" data-key=";"><span>;</span></div>
            <div class="key white" data-note="F4" data-key="'"><span>'</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Guitar Section (Step 3) -->


    <!-- Bass Engine Section (Step 4) -->
    <section class="tool-section" id="bass-tool" style="background: transparent; padding-top: 3rem; border: none;">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label" style="color: #10b981;">Step 4: Low Frequency</div>
          <h2 class="section-title">Bass Monosynth</h2>
          <p class="section-description">
            Analog-modeled monosynth for deep foundations.
            <span class="instruction-badge"
              style="display: inline-block; background: #27272a; border: 1px solid #3f3f46; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-left: 10px; color: #fff;">ðŸŽ¹
              Play Z-M</span>
          </p>
        </div>

        <div class="bass-wrapper"
          style="max-width: 1000px; margin: 0 auto; background: #18181b; border: 1px solid #27272a; border-radius: 12px; padding: 2rem;">

          <!-- Controls -->
          <div class="synth-controls" style="display: flex; gap: 2rem; margin-bottom: 2rem; justify-content: center;">
            <div class="knob-group" style="text-align: center;">
              <label style="display: block; font-size: 0.75rem; color: #a1a1aa; margin-bottom: 0.5rem;">Cutoff</label>
              <input type="range" id="bassCutoff" min="50" max="1000" value="300" style="accent-color: #10b981;">
            </div>
            <div class="knob-group" style="text-align: center;">
              <label
                style="display: block; font-size: 0.75rem; color: #a1a1aa; margin-bottom: 0.5rem;">Resonance</label>
              <input type="range" id="bassRes" min="0" max="20" value="5" style="accent-color: #10b981;">
            </div>
            <div class="knob-group" style="text-align: center;">
              <label style="display: block; font-size: 0.75rem; color: #a1a1aa; margin-bottom: 0.5rem;">Waveform</label>
              <select id="bassWave"
                style="background: #27272a; color: #fff; border: 1px solid #3f3f46; padding: 0.25rem; border-radius: 4px;">
                <option value="sawtooth">Sawtooth</option>
                <option value="square">Square</option>
                <option value="triangle">Triangle</option>
              </select>
            </div>
          </div>

          <!-- Bass Keys (Expanded to 2 Octaves) -->
          <div class="bass-keys" id="bassKeys"
            style="display: flex; justify-content: center; height: 200px; position: relative; overflow: hidden; border-radius: 0 0 8px 8px;">
            <!-- C1 -->
            <div class="bass-key" data-note="C1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="C#1"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 6%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- D1 -->
            <div class="bass-key" data-note="D1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="D#1"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 13%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- E1 -->
            <div class="bass-key" data-note="E1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <!-- F1 -->
            <div class="bass-key" data-note="F1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="F#1"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 27%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- G1 -->
            <div class="bass-key" data-note="G1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="G#1"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 34%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- A1 -->
            <div class="bass-key" data-note="A1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="A#1"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 41%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- B1 -->
            <div class="bass-key" data-note="B1"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>

            <!-- C2 -->
            <div class="bass-key" data-note="C2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="C#2"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 56%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- D2 -->
            <div class="bass-key" data-note="D2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="D#2"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 63%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- E2 -->
            <div class="bass-key" data-note="E2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <!-- F2 -->
            <div class="bass-key" data-note="F2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="F#2"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 77%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- G2 -->
            <div class="bass-key" data-note="G2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="G#2"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 84%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- A2 -->
            <div class="bass-key" data-note="A2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
            <div class="bass-key black" data-note="A#2"
              style="width: 3%; height: 120px; background: #000; position: absolute; left: 91%; z-index: 10; border-radius: 0 0 3px 3px; cursor: pointer;">
            </div>
            <!-- B2 -->
            <div class="bass-key" data-note="B2"
              style="flex:1; background: #fff; border: 1px solid #ccc; border-top: none; cursor: pointer;"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Atmosphere Section (Step 5) -->
    <section class="tool-section" id="atmosphere-tool"
      style="background: transparent; padding-top: 3rem; border: none;">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label" style="color: #10b981;">Step 5: Texture</div>
          <h2 class="section-title">Atmosphere</h2>
          <p class="section-description">
            Cinematic drone generator for spatial depth.
          </p>
        </div>

        <div class="atmosphere-wrapper"
          style="max-width: 800px; margin: 0 auto; height: 100px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
          <button class="drone-pad" data-chord="Cm9"
            style="background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; color: #a1a1aa; font-size: 1.25rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5);">
            Cm9
          </button>
          <button class="drone-pad" data-chord="Fm9"
            style="background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; color: #a1a1aa; font-size: 1.25rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5);">
            Fm9
          </button>
          <button class="drone-pad" data-chord="Ebmaj7"
            style="background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; color: #a1a1aa; font-size: 1.25rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5);">
            Ebmaj7
          </button>
          <button class="drone-pad" data-chord="Gsus4"
            style="background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; color: #a1a1aa; font-size: 1.25rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5);">
            Gsus4
          </button>
        </div>
      </div>
    </section>

    <!-- Lead Engine (Step 6) -->
    <section class="tool-section" id="lead-tool" style="background: transparent; padding-top: 3rem; border: none;">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label" style="color: #10b981;">Step 6: Melody & Solo</div>
          <h2 class="section-title">Lead Synth</h2>
          <p class="section-description">High-pitched GLIDE synth for cutting through the mix.</p>
        </div>
        <div class="lead-wrapper"
          style="max-width: 1000px; margin: 0 auto; background: #18181b; border: 1px solid #27272a; border-radius: 12px; padding: 1.5rem;">
          <div class="controls" style="text-align: center; margin-bottom: 1rem;">
            <label style="color: #a1a1aa; font-size: 0.8rem; margin-right: 10px;">Glide Time</label>
            <input type="range" id="leadGlide" min="0" max="0.5" step="0.01" value="0.1"
              style="accent-color: #10b981; vertical-align: middle;">
          </div>
          <div class="lead-keys" style="display: flex; gap: 2px; height: 100px;">
            <!-- C5 - C6 -->
            <button class="lead-key" data-note="C5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="D5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="E5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="F5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="G5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="A5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="B5"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
            <button class="lead-key" data-note="C6"
              style="flex:1; background: #3f3f46; border: none; border-radius: 4px; color: white;"></button>
          </div>
        </div>
      </div>
    </section>

    <!-- Beat Pad (Step 7) -->
    <section class="tool-section" id="beat-pad-tool"
      style="background: #18181b; padding: 4rem 0; border-top: 1px solid #27272a; border-bottom: 1px solid #27272a;">
      <div class="section-container">
        <div class="section-header">
          <div class="section-label" style="color: #10b981;">Step 7: Manual Percussion</div>
          <h2 class="section-title">MPC Beat Pad</h2>
          <p class="section-description">16-pad grid for finger drumming.</p>
        </div>
        <div class="mpc-grid"
          style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 600px; margin: 0 auto;">
          <!-- Row 1 -->
          <button class="mpc-pad" data-sound="crash"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="ride"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="tom1"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="tom2"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>

          <!-- Row 2 -->
          <button class="mpc-pad" data-sound="hihat-open"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="hihat-closed"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="clap"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="cowbell"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>

          <!-- Row 3 -->
          <button class="mpc-pad" data-sound="snare"
            style="aspect-ratio: 1; background: #3f3f46; border: 1px solid #52525b; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="snare-rim"
            style="aspect-ratio: 1; background: #3f3f46; border: 1px solid #52525b; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="shaker"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="snap"
            style="aspect-ratio: 1; background: #27272a; border: 1px solid #3f3f46; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>

          <!-- Row 4 -->
          <button class="mpc-pad" data-sound="kick"
            style="aspect-ratio: 1; background: #10b981; border: 1px solid #059669; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="kick-deep"
            style="aspect-ratio: 1; background: #10b981; border: 1px solid #059669; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="sub"
            style="aspect-ratio: 1; background: #10b981; border: 1px solid #059669; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
          <button class="mpc-pad" data-sound="impact"
            style="aspect-ratio: 1; background: #10b981; border: 1px solid #059669; border-radius: 8px; cursor: pointer; transition: all 0.1s;"></button>
        </div>
      </div>
    </section>

  </section> <!-- End Digital Studio -->



  <!-- Features Section -->
  <section class="features" id="tools">
    <div class="section-container">
      <div class="section-header">
        <div class="section-label">Tool Suite</div>
        <h2 class="section-title">Everything you need to create</h2>
        <p class="section-description">
          From sketch to master, our suite covers every stage of production.
        </p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M11.5 2a8.5 8.5 0 0 1 0 17v3l-3-3-3 3v-3a8.5 8.5 0 0 1 6-16z" />
              <circle cx="11.5" cy="10.5" r="3" />
              <path d="M11.5 7.5v-2M14.5 10.5h2M11.5 13.5v2M8.5 10.5h-2" />
            </svg>
          </div>
          <h3>Studio Guitar</h3>
          <p>High-fidelity guitar modeling with customizable effects chain.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="4" width="20" height="14" rx="2" />
              <circle cx="12" cy="11" r="3" />
              <path d="M10.5 9.5l4 3-4 3z" fill="currentColor" />
            </svg>
          </div>
          <h3>Grand Piano Engine</h3>
          <p>Full-range virtual piano with MIDI support and velocity sensitivity.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" />
              <circle cx="12" cy="12" r="4" />
              <path d="M12 8v4l2 2" />
            </svg>
          </div>
          <h3>Precision Tuner</h3>
          <p>Chromatic tuner with +/- 0.1 cent accuracy using browser audio API.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 18V5l12-2v13" />
              <circle cx="6" cy="18" r="3" />
              <circle cx="18" cy="16" r="3" />
              <path d="M9 9l12-2" />
            </svg>
          </div>
          <h3>Metronome Pro</h3>
          <p>Polyrhythm capable metronome with visual beat indicators and tap tempo.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" />
              <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
              <line x1="12" y1="19" x2="12" y2="22" />
              <path d="M8 22h8" />
              <path d="M3 10l1.5 1.5M21 10l-1.5 1.5M3 14l1.5-1.5M21 14l-1.5-1.5" />
            </svg>
          </div>
          <h3>Audio Analyzer</h3>
          <p>Real-time spectrogram and frequency analysis for sound engineering.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
          </div>
          <h3>Scale Dictionary</h3>
          <p>Comprehensive library of 500+ scales and modes mapped for any instrument.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 6v6l4 2"></path>
            </svg>
          </div>
          <h3>Circle of Fifths</h3>
          <p>Interactive harmonic wheel for songwriting and modulation visualization.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 12a11 11 0 0 1-22 0 11 11 0 0 1 22 0Z"></path>
              <path d="M9 12a3 3 0 1 0 6 0 3 3 0 1 0-6 0"></path>
            </svg>
          </div>
          <h3>Drum Sequencer</h3>
          <p>Browser-based 808 drum machine with programmable patterns and export.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 12h20"></path>
              <path d="M6 12v-3a6 6 0 0 1 12 0v3"></path>
            </svg>
          </div>
          <h3>Interval Trainer</h3>
          <p>Professional ear training tools for refining pitch recognition.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="m16 6-4 4-4-4"></path>
              <path d="M12 21V10"></path>
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            </svg>
          </div>
          <h3>Reverse Chord Finder</h3>
          <p>Identify unknown chords by simply selecting notes on the fretboard.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2v20"></path>
              <path d="M2 12h20"></path>
              <path d="m2 12 5 5"></path>
              <path d="m22 12-5 5"></path>
            </svg>
          </div>
          <h3>Stem Splitter</h3>
          <p>AI-powered track separation to isolate vocals, drums, or instruments.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </div>
          <h3>MIDI Recorder</h3>
          <p>Capture your ideas with a lightweight, browser-based DAW environment.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Pricing Section -->
  <section class="pricing" id="pricing">
    <div class="section-container">
      <div class="section-header">
        <div class="section-label">Pricing</div>
        <h2 class="section-title">Simple, transparent but dummy pricing</h2>
        <p class="section-description">
          Start with a free trial. No credit card required.
        </p>
      </div>
      <div class="billing-toggle">
        <button class="billing-option active" data-billing="monthly">Monthly</button>
        <button class="billing-option" data-billing="quarterly">
          Quarterly
          <span class="discount-badge">-15%</span>
        </button>
        <button class="billing-option" data-billing="yearly">
          Yearly
          <span class="discount-badge">-30%</span>
        </button>
      </div>
      <div class="pricing-grid">
        <div class="pricing-card">
          <div class="pricing-name">Starter</div>
          <div class="pricing-price">
            <span class="currency"></span>Free
          </div>
          <div class="pricing-billed"></div>
          <div class="pricing-savings"></div>
          <p class="pricing-description">Perfect for trying out the basics</p>
          <ul class="pricing-features">
            <li>10 beginner lessons</li>
            <li>Interactive fretboard</li>
            <li>5 songs with tabs</li>
            <li>Community access</li>
          </ul>
          <a href="#" class="pricing-btn">Get Started</a>
        </div>
        <div class="pricing-card featured" id="proCard">
          <div class="pricing-name">Pro</div>
          <div class="pricing-price">
            <span class="currency">$</span><span id="proPrice">30</span><span class="period">/mo</span>
          </div>
          <div class="pricing-billed" id="proBilled"></div>
          <div class="pricing-savings" id="proSavings"></div>
          <p class="pricing-description">For serious learners</p>
          <ul class="pricing-features">
            <li>All 200+ video lessons</li>
            <li>Full song library (500+)</li>
            <li>AI feedback on playing</li>
            <li>Progress tracking</li>
            <li>Download lessons offline</li>
          </ul>
          <a href="#" class="pricing-btn">Start Free Trial</a>
        </div>
        <div class="pricing-card">
          <div class="pricing-name">Lifetime</div>
          <div class="pricing-price">
            <span class="currency">$</span>440
          </div>
          <div class="pricing-billed">One-time payment</div>
          <div class="pricing-savings">Best value</div>
          <p class="pricing-description">Forever access, no recurring fees</p>
          <ul class="pricing-features">
            <li>Everything in Pro</li>
            <li>1-on-1 coaching session</li>
            <li>Exclusive masterclasses</li>
            <li>Priority support</li>
            <li>All future updates</li>
          </ul>
          <a href="#" class="pricing-btn">Get Lifetime Access</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Instructors Section -->
  <section class="instructors" id="instructors">
    <div class="section-container">
      <div class="section-header">
        <div class="section-label">Community</div>
        <h2 class="section-title">Collaborate with the best dummy artists</h2>
        <p class="section-description">
          Connect with top producers and sound designers from around the world.
        </p>
      </div>
      <div class="instructors-grid">
        <div class="instructor-card">
          <div class="instructor-image">
            <img src="public/images/acoustic-specialist.jpg" alt="Marcus Chen">
          </div>
          <div class="instructor-name">Marcus Chen</div>
          <div class="instructor-role">Sound Designer</div>
          <p class="instructor-bio">15 years producing, Berklee graduate</p>
        </div>
        <div class="instructor-card">
          <div class="instructor-image">
            <img src="public/images/fingerstyle-expert.jpg" alt="Sarah Williams">
          </div>
          <div class="instructor-name">Sarah Williams</div>
          <div class="instructor-role">Beatmaker</div>
          <p class="instructor-bio">YouTube producer, 2M subscribers</p>
        </div>
        <div class="instructor-card">
          <div class="instructor-image">
            <img src="public/images/blues-rock-guitar.jpg" alt="James Rodriguez">
          </div>
          <div class="instructor-name">James Rodriguez</div>
          <div class="instructor-role">Session Guitarist</div>
          <p class="instructor-bio">Studio musician, 20+ albums</p>
        </div>
        <div class="instructor-card">
          <div class="instructor-image">
            <img src="public/images/music-theory-instructor.jpg" alt="Emily Park">
          </div>
          <div class="instructor-name">Emily Park</div>
          <div class="instructor-role">Composer</div>
          <p class="instructor-bio">Film scorer, award-winning artist</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section class="testimonials" id="testimonials">
    <div class="section-container">
      <div class="section-header">
        <div class="section-label">Testimonials</div>
        <h2 class="section-title">What the dummy artists are saying</h2>
      </div>
      <div class="testimonials-grid">
        <div class="testimonial-card">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-text">"I've tried several DAWs, but StringMaster's immediate workflow finally
            made
            track production click for me. Went from zero to finishing songs in 3 months!"</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">
              <img src="public/images/alex-student.jpg" alt="Alex Thompson">
            </div>
            <div>
              <div class="testimonial-name">Alex Thompson</div>
              <div class="testimonial-title">Beatmaker, 4 months</div>
            </div>
          </div>
        </div>
        <div class="testimonial-card">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-text">"The AI visualization feature is incredible. It's like having a personal mix
            engineer
            available 24/7. My sound design has improved dramatically."</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">
              <img src="public/images/maria-student.jpg" alt="Maria Garcia">
            </div>
            <div>
              <div class="testimonial-name">Maria Garcia</div>
              <div class="testimonial-title">Artist, 1 year</div>
            </div>
          </div>
        </div>
        <div class="testimonial-card">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-text">"Worth every penny. The sound library keeps me inspired, and the project
            tools
            show exactly how far I've come. Highly recommend!"</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">
              <img src="public/images/david-student.jpg" alt="David Kim">
            </div>
            <div>
              <div class="testimonial-name">David Kim</div>
              <div class="testimonial-title">Pro Producer, 8 months</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta">
    <div class="section-container cta-content">
      <h2>Ready to record your next hit?</h2>
      <p>Join 50,000+ artists creating music the modern way. Access the full studio suite today.</p>
      <a href="#pricing" class="btn-primary">Launch Studio â†’</a>
    </div>
  </section>



  <script src="templatemo-606-string-scripts.js"></script>
  <script>
    // Error Handler for Debugging
    window.onerror = function (msg, url, lineNo, columnNo, error) {
      console.error("Script Error: " + msg + " at line " + lineNo);
      return false;
    };

    document.addEventListener('DOMContentLoaded', () => {
      console.log("DOM Loaded - Starting Green Enterprise Audio Engine");


      let audioCtx, masterGain, analyser;
      const activeNotes = {};
      const noteFrequencies = {
        'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00, 'G#3': 207.65, 'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
        'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
        'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77
      };

      function initAudio() {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();

          // Create Master Routing
          masterGain = audioCtx.createGain();
          masterGain.gain.value = 0.5; // Prevent clipping
          analyser = audioCtx.createAnalyser();
          analyser.fftSize = 256;

          masterGain.connect(analyser);
          analyser.connect(audioCtx.destination);

          // Start Visualizer Loop
          drawVisualizer();

          console.log("AudioContext & Visualizer Created");
        }
        if (audioCtx.state === 'suspended') {
          audioCtx.resume().then(() => console.log("Audio Resumed"));
        }
      }

      function drawVisualizer() {
        const canvas = document.getElementById('audioVisualizer');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        function draw() {
          requestAnimationFrame(draw);
          if (!analyser) return;

          analyser.getByteFrequencyData(dataArray);

          // Clear
          ctx.fillStyle = '#18181b';
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Draw Grid (Idle State)
          ctx.strokeStyle = '#27272a';
          ctx.lineWidth = 1;
          ctx.beginPath();
          for (let y = 20; y < canvas.height; y += 40) {
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
          }
          ctx.stroke();

          // Check if silent
          let sum = 0;
          for (let i = 0; i < bufferLength; i++) sum += dataArray[i];

          if (sum === 0 && audioCtx.state === 'running') {
            ctx.fillStyle = '#52525b';
            ctx.font = '16px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Play Audio to Visualize', canvas.width / 2, canvas.height / 2);
          }

          const barWidth = (canvas.width / bufferLength) * 2.5;
          let barHeight;
          let x = 0;

          for (let i = 0; i < bufferLength; i++) {
            barHeight = dataArray[i] / 255 * canvas.height;

            // Gradient: Emerald to Cyan
            const gradient = ctx.createLinearGradient(0, canvas.height, 0, canvas.height - barHeight);
            gradient.addColorStop(0, '#10b981');
            gradient.addColorStop(1, '#06b6d4');

            ctx.fillStyle = gradient;
            if (barHeight > 0) {
              ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
            }

            x += barWidth + 1;
          }
        }
        draw();
      }

      // Global unlock
      document.body.addEventListener('click', initAudio, { once: true });
      document.body.addEventListener('touchstart', initAudio, { once: true });

      // Test Audio Button
      const testAudioBtn = document.getElementById('testAudioBtn');
      if (testAudioBtn) {
        testAudioBtn.addEventListener('click', () => {
          initAudio();
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.connect(gain);
          if (masterGain) gain.connect(masterGain);
          else gain.connect(audioCtx.destination);

          // Sweep
          osc.frequency.setValueAtTime(200, audioCtx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.5);

          gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

          osc.start();
          osc.stop(audioCtx.currentTime + 0.5);
        });
      }


      // --- 2. VIRTUAL PIANO ENGINE ---
      const pianoKeys = document.querySelectorAll('.key');
      const pianoVolume = document.getElementById('pianoVolume');
      const sustainToggle = document.getElementById('sustainToggle');



      function playPianoNote(note) {
        initAudio();
        if (activeNotes[note]) stopPianoNote(note);

        const baseFreq = noteFrequencies[note];
        if (!baseFreq) return;

        const vol = pianoVolume ? parseFloat(pianoVolume.value) : 0.5;
        const now = audioCtx.currentTime;

        // Synthesis: Triangle + Sine mix
        const osc1 = audioCtx.createOscillator();
        const osc2 = audioCtx.createOscillator();
        osc1.type = 'triangle';
        osc2.type = 'sine';
        osc1.frequency.value = baseFreq;
        osc2.frequency.value = baseFreq;

        // Filter: Lowpass with opening envelope
        const filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(baseFreq * 4, now);
        filter.frequency.exponentialRampToValueAtTime(baseFreq * 1, now + 1);

        // Amp Envelope
        const gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0, now);
        gainNode.gain.linearRampToValueAtTime(vol, now + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(vol * 0.6, now + 0.5);

        osc1.connect(filter);
        osc2.connect(filter);
        filter.connect(gainNode);
        // ROUTING: Master for Visualizer
        if (masterGain) {
          gainNode.connect(masterGain);
        } else {
          gainNode.connect(audioCtx.destination);
        }

        osc1.start(now);
        osc2.start(now);

        activeNotes[note] = { osc1, osc2, gainNode, filter };

        // UI
        const keyEl = document.querySelector(`.key[data-note="${note}"]`);
        if (keyEl) keyEl.classList.add('active');
      }

      function stopPianoNote(note) {
        const active = activeNotes[note];
        if (active) {
          const now = audioCtx.currentTime;
          // Sustain Logic: 2.5s for "On", 0.2s for "Off"
          const release = (sustainToggle && sustainToggle.classList.contains('active')) ? 2.5 : 0.2;

          active.gainNode.gain.cancelScheduledValues(now);
          active.gainNode.gain.setValueAtTime(active.gainNode.gain.value, now);
          active.gainNode.gain.exponentialRampToValueAtTime(0.001, now + release);

          setTimeout(() => {
            active.osc1.stop();
            active.osc2.stop();
            delete activeNotes[note];
          }, release * 1000 + 100);
        }
        const keyEl = document.querySelector(`.key[data-note="${note}"]`);
        if (keyEl) keyEl.classList.remove('active');
      }


      // --- BASS ENGINE ---
      const bassKeys = document.querySelectorAll('.bass-key');
      bassKeys.forEach(key => {
        key.addEventListener('mousedown', () => playBassNote(key.dataset.note));
        key.addEventListener('mouseup', () => stopBassNote());
      });

      let bassOsc = null;
      let bassGain = null;

      function playBassNote(note) {
        initAudio();
        if (bassOsc) stopBassNote();

        const freqs = {
          'C1': 32.70, 'C#1': 34.65, 'D1': 36.71, 'D#1': 38.89, 'E1': 41.20, 'F1': 43.65,
          'F#1': 46.25, 'G1': 49.00, 'G#1': 51.91, 'A1': 55.00, 'A#1': 58.27, 'B1': 61.74,
          'C2': 65.41, 'C#2': 69.30, 'D2': 73.42, 'D#2': 77.78, 'E2': 82.41, 'F2': 87.31,
          'F#2': 92.50, 'G2': 98.00, 'G#2': 103.83, 'A2': 110.00, 'A#2': 116.54, 'B2': 123.47
        };

        const freq = freqs[note];
        if (!freq) return;

        bassOsc = audioCtx.createOscillator();
        bassGain = audioCtx.createGain();
        const filter = audioCtx.createBiquadFilter();

        const waveType = document.getElementById('bassWave') ? document.getElementById('bassWave').value : 'sawtooth';
        bassOsc.type = waveType;
        bassOsc.frequency.value = freq;

        filter.type = 'lowpass';
        filter.frequency.value = document.getElementById('bassCutoff') ? document.getElementById('bassCutoff').value : 300;
        filter.Q.value = document.getElementById('bassRes') ? document.getElementById('bassRes').value : 5;

        bassOsc.connect(filter);
        filter.connect(bassGain);

        if (masterGain) bassGain.connect(masterGain);
        else bassGain.connect(audioCtx.destination);

        const vol = document.getElementById('bassVol') ? parseFloat(document.getElementById('bassVol').value) : 0.4;
        bassGain.gain.setValueAtTime(vol, audioCtx.currentTime);
        bassOsc.start();

        // Visual
        const keyEl = document.querySelector(`.bass-key[data-note="${note}"]`);
        if (keyEl) keyEl.style.background = '#10b981';
      }

      function stopBassNote() {
        if (bassOsc) {
          const now = audioCtx.currentTime;
          bassGain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
          bassOsc.stop(now + 0.1);
          bassOsc = null;
        }
        // Visual Reset
        document.querySelectorAll('.bass-key').forEach(k => {
          if (k.classList.contains('black')) k.style.background = '#000';
          else k.style.background = '#fff';
        });
      }

      // --- ATMOSPHERE ENGINE ---
      const dronePads = document.querySelectorAll('.drone-pad');
      let activeDrones = [];

      dronePads.forEach(pad => {
        pad.addEventListener('click', function () {
          // Toggle
          if (this.classList.contains('active')) {
            this.classList.remove('active');
            this.style.borderColor = '#3f3f46';
            this.style.color = '#a1a1aa';
            stopDrone();
          } else {
            // Reset others
            dronePads.forEach(p => {
              p.classList.remove('active');
              p.style.borderColor = '#3f3f46';
              p.style.color = '#a1a1aa';
            });
            stopDrone();

            this.classList.add('active');
            this.style.borderColor = '#10b981';
            this.style.color = '#10b981';
            playDrone(this.dataset.chord);
          }
        });
      });

      function playDrone(chordName) {
        initAudio();
        // Simple triads for now
        const chords = {
          'Cm9': [130.81, 155.56, 196.00, 233.08], // C3, Eb3, G3, Bb3
          'Fm9': [174.61, 207.65, 261.63, 311.13],
          'Ebmaj7': [155.56, 196.00, 233.08, 261.63],
          'Gsus4': [196.00, 261.63, 293.66]
        };

        const freqs = chords[chordName];
        if (!freqs) return;

        freqs.forEach(f => {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.type = 'triangle';
          osc.frequency.value = f;

          // Detune for chorus effect
          const osc2 = audioCtx.createOscillator();
          osc2.type = 'sine';
          osc2.frequency.value = f * 1.01;

          osc.connect(gain);
          osc2.connect(gain);

          if (masterGain) gain.connect(masterGain);
          else gain.connect(audioCtx.destination);

          gain.gain.setValueAtTime(0, audioCtx.currentTime);
          gain.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 2); // Slow attack

          osc.start();
          osc2.start();

          activeDrones.push({ osc, osc2, gain });
        });
      }

      function stopDrone() {
        activeDrones.forEach(d => {
          d.gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2); // Slow release
          d.osc.stop(audioCtx.currentTime + 2);
          d.osc2.stop(audioCtx.currentTime + 2);
        });
        activeDrones = [];
      }

      // --- LEAD SYNTH ENGINE ---
      const leadKeys = document.querySelectorAll('.lead-key');
      let leadOsc = null;
      let leadGain = null;

      if (leadKeys) {
        leadKeys.forEach(key => {
          key.addEventListener('mousedown', () => playLeadNote(key.dataset.note));
          key.addEventListener('mouseup', () => stopLeadNote());
          // Touch support
          key.addEventListener('touchstart', (e) => { e.preventDefault(); playLeadNote(key.dataset.note); });
          key.addEventListener('touchend', (e) => { e.preventDefault(); stopLeadNote(); });
        });
      }

      function playLeadNote(note) {
        initAudio();
        const freqs = {
          'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46,
          'G5': 783.99, 'A5': 880.00, 'B5': 987.77, 'C6': 1046.50
        };

        const targetFreq = freqs[note];
        if (!targetFreq) return;

        const glideTime = document.getElementById('leadGlide') ? parseFloat(document.getElementById('leadGlide').value) : 0.1;
        const now = audioCtx.currentTime;

        if (leadOsc) {
          // Glide to new note
          leadOsc.frequency.cancelScheduledValues(now);
          leadOsc.frequency.linearRampToValueAtTime(targetFreq, now + glideTime);

          // Retrigger envelope slightly
          leadGain.gain.cancelScheduledValues(now);
          leadGain.gain.setValueAtTime(leadGain.gain.value, now);
          leadGain.gain.linearRampToValueAtTime(0.3, now + 0.05);
        } else {
          // New Note
          leadOsc = audioCtx.createOscillator();
          leadGain = audioCtx.createGain();

          leadOsc.type = 'square';
          leadOsc.frequency.value = targetFreq;

          leadOsc.connect(leadGain);
          if (masterGain) leadGain.connect(masterGain);
          else leadGain.connect(audioCtx.destination);

          leadGain.gain.setValueAtTime(0, now);
          leadGain.gain.linearRampToValueAtTime(0.3, now + 0.05);

          leadOsc.start(now);
        }

        // Visual
        document.querySelectorAll('.lead-key').forEach(k => k.style.background = '#3f3f46');
        const keyEl = document.querySelector(`.lead-key[data-note="${note}"]`);
        if (keyEl) keyEl.style.background = '#10b981';
      }

      function stopLeadNote() {
        if (leadOsc) {
          const now = audioCtx.currentTime;
          leadGain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
          leadOsc.stop(now + 0.2);
          leadOsc = null;
          leadGain = null;
        }
        document.querySelectorAll('.lead-key').forEach(k => k.style.background = '#3f3f46');
      }

      // --- MPC BEAT PAD ENGINE ---
      const pads = document.querySelectorAll('.mpc-pad');
      if (pads) {
        pads.forEach(pad => {
          pad.addEventListener('mousedown', () => {
            pad.style.transform = 'scale(0.95)';
            pad.style.borderColor = '#fff';
            playPadSound(pad.dataset.sound);
            setTimeout(() => {
              pad.style.transform = 'scale(1)';
              pad.style.borderColor = (pad.dataset.sound.includes('kick')) ? '#059669' : '#3f3f46';
            }, 100);
          });
        });
      }

      function playPadSound(type) {
        initAudio();
        const now = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        if (masterGain) gain.connect(masterGain);
        else gain.connect(audioCtx.destination);

        if (type.includes('kick') || type === 'sub') {
          osc.frequency.setValueAtTime(150, now);
          osc.frequency.exponentialRampToValueAtTime(0.01, now + 0.5);
          gain.gain.setValueAtTime(1, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
          osc.start(now);
          osc.stop(now + 0.5);
        } else if (type.includes('snare')) {
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(200, now);
          gain.gain.setValueAtTime(0.5, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);

          // White noise burst for snare
          const noiseSize = audioCtx.sampleRate * 0.2;
          const buffer = audioCtx.createBuffer(1, noiseSize, audioCtx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < noiseSize; i++) data[i] = Math.random() * 2 - 1;
          const noise = audioCtx.createBufferSource();
          noise.buffer = buffer;
          const noiseGain = audioCtx.createGain();
          noiseGain.gain.setValueAtTime(0.5, now);
          noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
          noise.connect(noiseGain);
          noiseGain.connect(masterGain);
          noise.start(now);

          osc.start(now);
          osc.stop(now + 0.2);
        } else if (type.includes('hihat')) {
          // High pass noise
          // Simplified for now: High square
          osc.type = 'square';
          osc.frequency.value = 800;
          if (type === 'hihat-open') {
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now); osc.stop(now + 0.3);
          } else {
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
            osc.start(now); osc.stop(now + 0.05);
          }
        } else {
          // Default "blip"
          osc.type = 'sine';
          osc.frequency.setValueAtTime(800, now);
          osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
          gain.gain.setValueAtTime(0.3, now);
          gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
          osc.start(now); osc.stop(now + 0.1);
        }
      }

      // --- 2. VIRTUAL PIANO ENGINE ---
      function playPianoNote(note) {
        initAudio();
        // Stop existing note if any
        if (activeNotes[note]) stopPianoNote(note);

        const baseFreq = noteFrequencies[note];
        if (!baseFreq) return;

        // Get Volume from Mixer or internal slider
        const volEl = document.getElementById('pianoVol') || document.getElementById('pianoVolume');
        const vol = volEl ? parseFloat(volEl.value) : 0.5;

        const now = audioCtx.currentTime;

        // Synthesis: Triangle + Sine mix
        const osc1 = audioCtx.createOscillator();
        const osc2 = audioCtx.createOscillator();
        osc1.type = 'triangle';
        osc2.type = 'sine';
        osc1.frequency.value = baseFreq;
        osc2.frequency.value = baseFreq;

        // Filter: Lowpass with opening envelope
        const filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(baseFreq * 4, now);
        filter.frequency.exponentialRampToValueAtTime(baseFreq * 1, now + 1);

        // Amp Envelope
        const gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0, now);
        gainNode.gain.linearRampToValueAtTime(vol, now + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(vol * 0.6, now + 0.5);

        osc1.connect(filter);
        osc2.connect(filter);
        filter.connect(gainNode);

        // ROUTING: Master for Visualizer
        if (masterGain) {
          gainNode.connect(masterGain);
        } else {
          gainNode.connect(audioCtx.destination);
        }

        osc1.start(now);
        osc2.start(now);

        activeNotes[note] = { osc1, osc2, gainNode, filter };

        // UI
        const keyEl = document.querySelector(`.key[data-note="${note}"]`);
        if (keyEl) keyEl.classList.add('active');
      }

      function stopPianoNote(note) {
        const active = activeNotes[note];
        if (active) {
          const now = audioCtx.currentTime;
          // Sustain Logic: 2.5s for "On", 0.2s for "Off"
          const release = (sustainToggle && sustainToggle.classList.contains('active')) ? 2.5 : 0.2;

          active.gainNode.gain.cancelScheduledValues(now);
          active.gainNode.gain.setValueAtTime(active.gainNode.gain.value, now);
          active.gainNode.gain.exponentialRampToValueAtTime(0.001, now + release);

          setTimeout(() => {
            active.osc1.stop();
            active.osc2.stop();
            delete activeNotes[note];
          }, release * 1000 + 100);
        }
        const keyEl = document.querySelector(`.key[data-note="${note}"]`);
        if (keyEl) keyEl.classList.remove('active');
      }

      // Piano Listeners
      if (pianoKeys) {
        pianoKeys.forEach(key => {
          key.addEventListener('mousedown', (e) => { e.preventDefault(); playPianoNote(key.dataset.note); });
          key.addEventListener('mouseup', () => stopPianoNote(key.dataset.note));
          key.addEventListener('mouseleave', () => stopPianoNote(key.dataset.note));
          key.addEventListener('touchstart', (e) => { e.preventDefault(); playPianoNote(key.dataset.note); });
          key.addEventListener('touchend', (e) => { e.preventDefault(); stopPianoNote(key.dataset.note); });
        });
      }

      if (sustainToggle) {
        sustainToggle.addEventListener('click', () => {
          sustainToggle.classList.toggle('active');
        });
      }

      // Piano Auto-Player
      const pianoPlayBtn = document.getElementById('pianoPlayBtn');
      const pianoSongSelect = document.getElementById('pianoSongSelect');
      const pianoProgressBar = document.getElementById('pianoProgressBar');
      const pianoSongTitle = document.getElementById('pianoSongTitle');
      let pianoIsPlaying = false;
      let pianoTimeouts = [];

      const pianoSongs = {
        'moonlight': [
          { t: 0, n: 'C#3' }, { t: 300, n: 'G#3' }, { t: 600, n: 'C#4' },
          { t: 900, n: 'C#3' }, { t: 1200, n: 'G#3' }, { t: 1500, n: 'C#4' },
          { t: 1800, n: 'C#3' }, { t: 2100, n: 'G#3' }, { t: 2400, n: 'C#4' },
          { t: 2700, n: 'C#3' }, { t: 3000, n: 'G#3' }, { t: 3300, n: 'C#4' },
          { t: 3600, n: 'C#3' }, { t: 3600, n: 'G#4' }, { t: 3900, n: 'G#3' }, { t: 4200, n: 'C#4' },
        ],
        'fur_elise': [
          { t: 0, n: 'E5' }, { t: 250, n: 'D#5' }, { t: 500, n: 'E5' }, { t: 750, n: 'D#5' }, { t: 1000, n: 'E5' },
          { t: 1250, n: 'B4' }, { t: 1500, n: 'D5' }, { t: 1750, n: 'C5' }, { t: 2000, n: 'A4' },
        ],
        'twinkle': [
          { t: 0, n: 'C4' }, { t: 500, n: 'C4' }, { t: 1000, n: 'G4' }, { t: 1500, n: 'G4' },
          { t: 2000, n: 'A4' }, { t: 2500, n: 'A4' }, { t: 3000, n: 'G4' },
          { t: 4000, n: 'F4' }, { t: 4500, n: 'F4' }, { t: 5000, n: 'E4' }, { t: 5500, n: 'E4' },
          { t: 6000, n: 'D4' }, { t: 6500, n: 'D4' }, { t: 7000, n: 'C4' },
        ],
        'scale_c': [
          { t: 0, n: 'C3' }, { t: 200, n: 'D3' }, { t: 400, n: 'E3' }, { t: 600, n: 'F3' }, { t: 800, n: 'G3' }, { t: 1000, n: 'A3' }, { t: 1200, n: 'B3' },
          { t: 1400, n: 'C4' }, { t: 1600, n: 'D4' }, { t: 1800, n: 'E4' }, { t: 2000, n: 'F4' }, { t: 2200, n: 'G4' }, { t: 2400, n: 'A4' }, { t: 2600, n: 'B4' },
        ]
      };

      function playPianoSong() {
        if (pianoIsPlaying) { stopPianoSong(); return; }

        const songKey = pianoSongSelect ? pianoSongSelect.value : null;
        if (!songKey || !pianoSongs[songKey]) return;

        initAudio();
        pianoIsPlaying = true;
        if (pianoPlayBtn) { pianoPlayBtn.textContent = 'â¸'; pianoPlayBtn.classList.add('playing'); }
        if (pianoProgressBar) { pianoProgressBar.style.width = '0%'; }

        const songData = pianoSongs[songKey];
        const totalDuration = songData[songData.length - 1].t + 1000;

        if (pianoProgressBar) {
          pianoProgressBar.style.transition = `width ${totalDuration}ms linear`;
          void pianoProgressBar.offsetWidth; // Trigger reflow
          pianoProgressBar.style.width = '100%';
        }

        songData.forEach(event => {
          const timeout = setTimeout(() => {
            playPianoNote(event.n);
            setTimeout(() => stopPianoNote(event.n), 400);
          }, event.t);
          pianoTimeouts.push(timeout);
        });

        const endTimeout = setTimeout(() => stopPianoSong(), totalDuration);
        pianoTimeouts.push(endTimeout);
      }

      function stopPianoSong() {
        pianoIsPlaying = false;
        if (pianoPlayBtn) { pianoPlayBtn.textContent = 'â–¶'; pianoPlayBtn.classList.remove('playing'); }
        pianoTimeouts.forEach(id => clearTimeout(id));
        pianoTimeouts = [];
        if (pianoProgressBar) { pianoProgressBar.style.transition = 'none'; pianoProgressBar.style.width = '0%'; }
      }

      if (pianoPlayBtn) pianoPlayBtn.addEventListener('click', playPianoSong);
      if (pianoSongSelect) {
        pianoSongSelect.addEventListener('change', () => {
          stopPianoSong();
          const name = pianoSongSelect.options[pianoSongSelect.selectedIndex].text;
          if (pianoSongTitle) pianoSongTitle.textContent = name;
        });
      }


      // --- 3. DRUM MACHINE ENGINE (Use Step-Based Logic) ---
      const drumPlayBtn = document.getElementById('drumPlay');
      const drumStopBtn = document.getElementById('drumStop');
      const bpmDisplay = document.getElementById('bpmValue');
      const steps = document.querySelectorAll('.step');

      let drumIsPlaying = false;
      let currentStep = 0;
      let tempo = 120;
      let nextNoteTime = 0.0;
      let timerID = null;
      let lookahead = 25.0; // ms
      let scheduleAheadTime = 0.1; // s

      if (steps) {
        steps.forEach(step => {
          step.addEventListener('click', () => {
            step.classList.toggle('active');
            initAudio();
          });
        });
      }

      function nextNote() {
        const secondsPerBeat = 60.0 / tempo;
        nextNoteTime += 0.25 * secondsPerBeat; // 16th notes
        currentStep = (currentStep + 1) % 16;
      }

      function scheduleNote(beatNumber, time) {
        // Visual Update
        requestAnimationFrame(() => {
          document.querySelectorAll('.step.playing').forEach(s => s.classList.remove('playing'));
          document.querySelectorAll(`.step[data-step="${beatNumber}"]`).forEach(s => s.classList.add('playing'));
        });

        // Audio Trigger
        ['kick', 'snare', 'hihat', 'clap'].forEach(track => {
          const row = document.querySelector(`.steps[data-track="${track}"]`);
          if (!row) return;
          const step = row.querySelector(`.step[data-step="${beatNumber}"]`);
          if (step && step.classList.contains('active')) {
            playDrumSound(track, time);
          }
        });
      }

      function playDrumSound(type, time) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        // ROUTING: Master for Visualizer
        if (masterGain) {
          gain.connect(masterGain);
        } else {
          gain.connect(audioCtx.destination);
        }

        if (type === 'kick') {
          osc.frequency.setValueAtTime(150, time);
          osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.5);
          gain.gain.setValueAtTime(1, time);
          gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);
          osc.start(time);
          osc.stop(time + 0.5);
        } else if (type === 'snare') {
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(100, time);
          gain.gain.setValueAtTime(0.5, time);
          gain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
          osc.start(time);
          osc.stop(time + 0.1);
        } else if (type === 'hihat') {
          osc.type = 'square';
          osc.frequency.setValueAtTime(1200, time);
          gain.gain.setValueAtTime(0.2, time);
          gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
          osc.start(time);
          osc.stop(time + 0.05);
        } else if (type === 'clap') {
          // Fixed Clap Logic
          const now = time;
          for (let i = 0; i < 3; i++) {
            const cOsc = audioCtx.createOscillator();
            const cGain = audioCtx.createGain();
            cOsc.type = 'triangle';
            cOsc.frequency.value = 800 + Math.random() * 200;
            cOsc.connect(cGain);
            // ROUTING: Master for Visualizer
            if (masterGain) {
              cGain.connect(masterGain);
            } else {
              cGain.connect(audioCtx.destination);
            }
            cGain.gain.setValueAtTime(0.2, now + i * 0.01);
            cGain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.01 + 0.07);
            cOsc.start(now + i * 0.01);
            cOsc.stop(now + i * 0.01 + 0.07);
          }
        }
      }

      function scheduler() {
        // While there are notes that will need to play before the next interval, schedule them
        while (nextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
          scheduleNote(currentStep, nextNoteTime);
          nextNote();
        }
        timerID = window.setTimeout(scheduler, lookahead);
      }

      if (drumPlayBtn) {
        drumPlayBtn.addEventListener('click', () => {
          if (drumIsPlaying) return;
          initAudio();
          drumIsPlaying = true;
          currentStep = 0;
          nextNoteTime = audioCtx.currentTime;
          scheduler();
          drumPlayBtn.style.color = '#10b981';
        });
      }

      if (drumStopBtn) {
        drumStopBtn.addEventListener('click', () => {
          drumIsPlaying = false;
          window.clearTimeout(timerID);
          document.querySelectorAll('.step.playing').forEach(s => s.classList.remove('playing'));
          if (drumPlayBtn) drumPlayBtn.style.color = '';
        });
      }

      // Keyboard Support for Piano (Global)
      const keyMap = {
        'a': 'C3', 'w': 'C#3', 's': 'D3', 'e': 'D#3', 'd': 'E3', 'f': 'F3', 't': 'F#3', 'g': 'G3', 'y': 'G#3', 'h': 'A3', 'u': 'A#3', 'j': 'B3',
        'k': 'C4', 'o': 'C#4', 'l': 'D4', 'p': 'D#4', ';': 'E4', "'": 'F4',
        'z': 'C5', 'x': 'D5', 'c': 'E5', 'v': 'F5', 'b': 'G5', 'n': 'A5', 'm': 'B5'
      };

      document.addEventListener('keydown', (e) => {
        if (e.repeat) return;
        // Only trigger if no focused input (so we don't play keys while typing)
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        const note = keyMap[e.key.toLowerCase()];
        if (note) playPianoNote(note);
      });

      document.addEventListener('keyup', (e) => {
        const note = keyMap[e.key.toLowerCase()];
        if (note) stopPianoNote(note);
      });

      // --- DRUM PRESETS LOGIC ---
      window.loadDrumPreset = function (type) {
        // Clear Grid
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));

        initAudio();

        if (type === 'rock') {
          // Kick: 1, 3 (steps 0, 8)
          [0, 8].forEach(s => document.querySelector(`.steps[data-track="kick"] .step[data-step="${s}"]`)?.classList.add('active'));
          // Snare: 2, 4 (steps 4, 12)
          [4, 12].forEach(s => document.querySelector(`.steps[data-track="snare"] .step[data-step="${s}"]`)?.classList.add('active'));
          // HiHat: 8ths
          [0, 2, 4, 6, 8, 10, 12, 14].forEach(s => document.querySelector(`.steps[data-track="hihat"] .step[data-step="${s}"]`)?.classList.add('active'));
        }
        else if (type === 'techno') {
          // Kick: 4-on-floor
          [0, 4, 8, 12].forEach(s => document.querySelector(`.steps[data-track="kick"] .step[data-step="${s}"]`)?.classList.add('active'));
          // HiHat: Off-beats
          [2, 6, 10, 14].forEach(s => document.querySelector(`.steps[data-track="hihat"] .step[data-step="${s}"]`)?.classList.add('active'));
          // Clap: 2, 4
          [4, 12].forEach(s => document.querySelector(`.steps[data-track="clap"] .step[data-step="${s}"]`)?.classList.add('active'));
        }
      };


      // --- JAM SESSION LOGIC ---
      window.startJamSession = function () {
        initAudio();

        // 1. Load Drums
        if (window.loadDrumPreset) loadDrumPreset('techno');

        // 2. Start Drums
        const drumPlay = document.getElementById('drumPlay');
        if (drumPlay) {
          drumPlay.click();
        }

        // 3. Load Piano
        const pianoSelect = document.getElementById('pianoSongSelect');
        if (pianoSelect) {
          pianoSelect.value = 'moonlight';
          // Trigger change event if needed, but we call play directly
        }

        // 4. Start Piano
        if (typeof playPianoSong === 'function') {
          // Stop if playing to reset
          if (window.pianoIsPlaying) stopPianoSong();
          setTimeout(() => playPianoSong(), 100);
        }

        // 5. Scroll to Visualizer
        const studio = document.getElementById('digital-studio');
        if (studio) {
          studio.scrollIntoView({ behavior: 'smooth' });
        }
      };

      // --- METRONOME ENGINE ---
      const metroBpmSlider = document.getElementById('metroBpmSlider');
      const metroBpmVal = document.getElementById('metroBpmVal');
      const metroPlayBtn = document.getElementById('metroPlayBtn');
      const metroVisual = document.getElementById('metroVisual');

      let metroIsPlaying = false;
      let metroTempo = 120;
      let metroNextNoteTime = 0.0;
      let metroTimerID = null;

      function metroNextNote() {
        const secondsPerBeat = 60.0 / metroTempo;
        metroNextNoteTime += secondsPerBeat;
      }

      function metroScheduleNote(time) {
        // Visual
        requestAnimationFrame(() => {
          if (metroVisual) {
            metroVisual.style.background = '#10b981';
            metroVisual.style.boxShadow = '0 0 15px #10b981';
            setTimeout(() => {
              metroVisual.style.background = '#3f3f46';
              metroVisual.style.boxShadow = 'none';
            }, 100);
          }
        });

        // Audio Click
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        // ROUTING: Master for Visualizer
        if (masterGain) {
          gain.connect(masterGain);
        } else {
          gain.connect(audioCtx.destination);
        }

        osc.frequency.value = 1000;
        gain.gain.setValueAtTime(1, time);
        gain.gain.exponentialRampToValueAtTime(0.001, time + 0.05);

        osc.start(time);
        osc.stop(time + 0.05);
      }

      function metroScheduler() {
        while (metroNextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
          metroScheduleNote(metroNextNoteTime);
          metroNextNote();
        }
        metroTimerID = window.setTimeout(metroScheduler, 25);
      }

      if (metroBpmSlider) {
        metroBpmSlider.addEventListener('input', (e) => {
          metroTempo = e.target.value;
          if (metroBpmVal) metroBpmVal.textContent = metroTempo;
        });
      }

      if (metroPlayBtn) {
        metroPlayBtn.addEventListener('click', () => {
          if (metroIsPlaying) {
            metroIsPlaying = false;
            window.clearTimeout(metroTimerID);
            metroPlayBtn.innerHTML = '<svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z" /></svg>';
            metroPlayBtn.classList.remove('active'); // Add a class if you want specific active styling
            metroPlayBtn.style.color = '';
          } else {
            initAudio();
            metroIsPlaying = true;
            metroNextNoteTime = audioCtx.currentTime;
            metroScheduler();
            metroPlayBtn.innerHTML = '<svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" /></svg>';
            metroPlayBtn.style.color = '#10b981';
          }
        });
      }
    }); // End DOMContentLoaded
  </script>


  <!-- Footer -->
  <footer>
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="#" class="logo">
          <div class="logo-icon">â™ª</div>
          StringMaster
        </a>
        <p>The ultimate browser-based production suite for artists. Sketch, record, and master anywhere.</p>
      </div>

      <div class="footer-column">
        <h4 class="footer-title">Platform</h4>
        <ul class="footer-links">
          <li><a href="#features">Features</a></li>
          <li><a href="#pricing">Pricing</a></li>
          <li><a href="#instructors">Instructors</a></li>
          <li><a href="#digital-studio">Studio</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4 class="footer-title">Resources</h4>
        <ul class="footer-links">
          <li><a href="#">Blog</a></li>
          <li><a href="#">Community</a></li>
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Status</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4 class="footer-title">Legal</h4>
        <ul class="footer-links">
          <li><a href="privacy.html">Privacy Policy</a></li>
          <li><a href="terms.html">Terms of Service</a></li>
          <li><a href="#">Cookie Policy</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2026 StringMaster. All rights reserved.</p>
      <div class="social-links" style="display: flex; gap: 1rem;">
        <a href="#">Twitter</a>
        <a href="#">Instagram</a>
        <a href="#">YouTube</a>
      </div>
    </div>
  </footer>

</body>

</html>